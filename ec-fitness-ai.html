<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Client Intake Portal | EC Fitness</title>
<!-- EmailJS SDK — sends intake notifications to trainer -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  (function(){ emailjs.init({ publicKey: 't_et8P0ReUizPYZln' }); })();
</script>
<!-- Supabase SDK — auth + database -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* ═══════════════════════════════════════════
   DESIGN SYSTEM — mirrors index.html exactly
═══════════════════════════════════════════ */
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --primary-gold: #d4af37;
  --dark-bg:      #1a1a1a;
  --darker-bg:    #000000;
  --text-light:   #ffffff;
  --text-gray:    #b0b0b0;
  --accent-grad:  linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
  --border-gold:  rgba(212,175,55,0.15);
  --border-sub:   rgba(255,255,255,0.06);
  --red:   #e05252;
  --green: #52b788;
  --amber: #f4a261;
}

html { scroll-behavior: smooth; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--darker-bg);
  color: var(--text-light);
  font-size: 16px;
  line-height: 1.6;
  overflow-x: hidden;
}

/* ── HEADER ─────────────────────────────── */
header {
  background: rgba(26,26,26,0.97);
  backdrop-filter: blur(10px);
  position: fixed; width: 100%; top: 0; z-index: 1000;
  border-bottom: 1px solid var(--border-gold);
}
nav {
  max-width: 1400px; margin: 0 auto;
  padding: 1rem 5%;
  display: flex; justify-content: space-between; align-items: center;
}
.logo { font-size: 1.5rem; font-weight: 700; color: var(--primary-gold); letter-spacing: 2px; text-decoration: none; }
.logo-slash { color: var(--text-light); }
.nav-links { display: none; gap: 2rem; align-items: center; }
.nav-links a { color: var(--text-gray); text-decoration: none; font-size: 0.9rem; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; transition: color 0.3s; }
.nav-links a:hover, .nav-links a.active { color: var(--primary-gold); }
.mobile-menu-btn { display: block; background: none; border: none; color: var(--primary-gold); font-size: 1.5rem; cursor: pointer; }
@media (min-width: 768px) { .mobile-menu-btn { display: none; } .nav-links { display: flex; } }

/* ── VIEWS ──────────────────────────────── */
.view { display: none; padding-top: 70px; min-height: 100vh; }
.view.active { display: block; }

/* ═══════════════════════════════════════════
   LOGIN / PORTAL ENTRY
═══════════════════════════════════════════ */
.portal-entry {
  min-height: calc(100vh - 70px);
  display: flex; align-items: center; justify-content: center;
  padding: 3rem 5%;
}
.entry-card {
  width: 100%; max-width: 480px;
  background: var(--dark-bg);
  border: 1px solid var(--border-gold);
  padding: 3rem 2.5rem;
}
.entry-logo { font-size: 1.5rem; font-weight: 700; color: var(--primary-gold); letter-spacing: 2px; text-align: center; margin-bottom: 0.25rem; }
.entry-sub { font-size: 0.75rem; color: var(--text-gray); text-transform: uppercase; letter-spacing: 2px; text-align: center; margin-bottom: 2.5rem; }
.entry-divider { text-align: center; font-size: 0.78rem; color: var(--text-gray); margin: 1.5rem 0; position: relative; }
.entry-divider::before, .entry-divider::after { content:''; display:block; position:absolute; top:50%; width:42%; height:1px; background: var(--border-gold); }
.entry-divider::before { left:0; } .entry-divider::after { right:0; }

/* shared login field */
.lfield { display: flex; flex-direction: column; gap: 6px; margin-bottom: 1.25rem; }
.lfield label { font-size: 0.78rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--primary-gold); }
.lfield input {
  background: var(--darker-bg); border: 1px solid rgba(212,175,55,0.2);
  color: var(--text-light); padding: 14px 16px;
  font-family: inherit; font-size: 1rem; border-radius: 2px; outline: none; width: 100%;
  transition: border-color 0.2s;
}
.lfield input:focus { border-color: var(--primary-gold); }

.login-err { font-size: 0.85rem; color: var(--red); margin-top: 0.75rem; text-align: center; display: none; }

/* 2FA digits */
.tfa-hint { font-size: 0.92rem; color: var(--text-gray); margin-bottom: 1.5rem; line-height: 1.6; text-align: center; }
.tfa-row { display: flex; gap: 10px; justify-content: center; margin-bottom: 1.5rem; }
.tfa-digit {
  width: 52px; height: 60px; text-align: center;
  font-size: 1.6rem; font-weight: 700;
  background: var(--darker-bg); border: 1px solid rgba(212,175,55,0.25);
  color: var(--text-light); border-radius: 3px; outline: none; font-family: inherit;
  transition: border-color 0.2s;
}
.tfa-digit:focus { border-color: var(--primary-gold); }
.tfa-resend { font-size: 0.82rem; color: var(--text-gray); text-align: center; margin-top: 0.75rem; }
.tfa-resend a { color: var(--primary-gold); cursor: pointer; }
@media (max-width:480px) { .tfa-digit { width:42px; height:52px; font-size:1.3rem; } }

/* ═══════════════════════════════════════════
   CLIENT INTAKE FORM
═══════════════════════════════════════════ */

/* Hero */
.intake-hero {
  padding: 3.5rem 5% 2.5rem;
  border-bottom: 1px solid var(--border-gold);
  background: linear-gradient(135deg, rgba(212,175,55,0.04) 0%, transparent 60%);
}
.intake-eyebrow { color: var(--primary-gold); font-size: 0.85rem; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 1rem; }
.intake-hero h1 { font-size: clamp(2rem, 5vw, 3.2rem); font-weight: 800; line-height: 1.1; margin-bottom: 1rem; letter-spacing: -0.5px; }
.intake-hero h1 span { color: var(--primary-gold); }
.intake-hero p { color: var(--text-gray); font-size: 1.05rem; line-height: 1.8; max-width: 560px; }

/* Stepper */
.stepper {
  display: flex; align-items: center; padding: 1.1rem 5%;
  border-bottom: 1px solid var(--border-gold);
  background: var(--dark-bg); overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
.step { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.step-num {
  width: 34px; height: 34px; border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.15);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.82rem; font-weight: 600; color: var(--text-gray);
  transition: all 0.3s;
}
.step.active .step-num { border-color: var(--primary-gold); color: var(--primary-gold); background: rgba(212,175,55,0.1); }
.step.done .step-num { background: var(--primary-gold); color: #000; border-color: var(--primary-gold); }
.step-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-gray); white-space: nowrap; }
.step.active .step-label { color: var(--text-light); font-weight: 600; }
.step.done .step-label { color: var(--primary-gold); }
.step-line { width: 30px; height: 1px; background: rgba(255,255,255,0.1); flex-shrink: 0; margin: 0 4px; }
.step.done + .step-line { background: var(--primary-gold); }

/* Section container */
.form-section { display: none; }
.form-section.active { display: block; }
.section-wrap { padding: 2.75rem 5%; max-width: 920px; }

.section-eyebrow { color: var(--primary-gold); font-size: 0.82rem; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 0.6rem; }
.section-title { font-size: 1.9rem; font-weight: 800; margin-bottom: 0.4rem; line-height: 1.15; }
.section-subtitle { font-size: 0.95rem; color: var(--text-gray); margin-bottom: 2.25rem; line-height: 1.65; }
.subsection-label {
  font-size: 0.8rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase;
  color: var(--primary-gold); margin-bottom: 1.25rem; padding-bottom: 0.6rem;
  border-bottom: 1px solid var(--border-gold);
}
.divider { border: none; border-top: 1px solid var(--border-sub); margin: 2.25rem 0; }

/* Form grid + fields */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; }
.form-grid.three { grid-template-columns: 1fr 1fr 1fr; }
.form-grid.one { grid-template-columns: 1fr; }
.field { display: flex; flex-direction: column; gap: 6px; }
.field.span2 { grid-column: span 2; }
.field.span3 { grid-column: span 3; }

label { font-size: 0.8rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--primary-gold); }

input, select, textarea {
  background: var(--dark-bg);
  border: 1px solid rgba(212,175,55,0.2);
  color: var(--text-light); padding: 14px 16px;
  font-family: inherit; font-size: 1rem;
  border-radius: 2px; outline: none; width: 100%;
  transition: border-color 0.2s;
}
input:focus, select:focus, textarea:focus { border-color: var(--primary-gold); background: rgba(26,26,26,0.9); }
input::placeholder, textarea::placeholder { color: rgba(176,176,176,0.45); }
select option { background: var(--dark-bg); }
textarea { resize: vertical; min-height: 88px; }
.auto-field { color: var(--primary-gold) !important; cursor: default; }

/* Range sliders */
.scale-row { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
.scale-row .scale-lbl { font-size: 0.95rem; font-weight: 400; color: var(--text-light); text-transform: none; letter-spacing: 0; min-width: 220px; }
input[type=range] {
  -webkit-appearance: none; padding: 0; height: 4px;
  background: rgba(212,175,55,0.2); border: none; border-radius: 2px; flex: 1; min-width: 120px;
}
input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: var(--primary-gold); border-radius: 50%; cursor: pointer; }
.scale-val { font-size: 1rem; font-weight: 700; color: var(--primary-gold); min-width: 28px; text-align: right; }

/* Pill buttons */
.pill-group { display: flex; gap: 10px; flex-wrap: wrap; }
.pill {
  padding: 10px 20px; border: 1px solid rgba(212,175,55,0.2);
  background: var(--dark-bg); color: var(--text-gray);
  cursor: pointer; font-family: inherit; font-size: 0.95rem;
  border-radius: 2px; transition: all 0.15s; user-select: none;
}
.pill.selected { border-color: var(--primary-gold); color: var(--primary-gold); background: rgba(212,175,55,0.08); }

/* PAR-Q */
.parq-item {
  display: flex; align-items: flex-start; gap: 1rem;
  padding: 1.1rem 0; border-bottom: 1px solid var(--border-sub);
}
.parq-item:last-child { border-bottom: none; }
.parq-text { flex: 1; font-size: 1rem; line-height: 1.75; }
.parq-text strong { color: var(--amber); }
.yn-wrap { display: flex; gap: 8px; flex-shrink: 0; margin-top: 3px; }
.yn-btn {
  padding: 9px 18px; border: 1px solid rgba(255,255,255,0.15);
  background: var(--dark-bg); color: var(--text-gray);
  cursor: pointer; font-family: inherit; font-size: 0.88rem; font-weight: 700;
  letter-spacing: 1px; border-radius: 2px; transition: all 0.15s;
}
.yn-btn.yes.sel { border-color: var(--red); color: var(--red); background: rgba(224,82,82,0.08); }
.yn-btn.no.sel  { border-color: var(--green); color: var(--green); background: rgba(82,183,136,0.08); }
.parq-detail {
  display: none; margin-top: 0.6rem; width: 100%;
  background: rgba(212,175,55,0.04); border: 1px solid var(--border-gold);
  color: var(--text-light); padding: 10px 14px;
  font-family: inherit; font-size: 0.95rem; border-radius: 2px; outline: none;
}
.parq-detail:focus { border-color: var(--primary-gold); }

/* ═══════════════════════════════════════════
   VIDEO UPLOAD SECTION
═══════════════════════════════════════════ */

/* Instruction panel */
.video-guide {
  background: var(--dark-bg);
  border: 1px solid var(--border-gold);
  border-left: 4px solid var(--primary-gold);
  padding: 1.75rem 2rem;
  margin-bottom: 2rem;
}
.video-guide-title {
  font-size: 1rem; font-weight: 700; color: var(--primary-gold);
  text-transform: uppercase; letter-spacing: 1.5px;
  margin-bottom: 1.5rem; display: flex; align-items: center; gap: 10px;
}
.guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
.guide-col h4 {
  font-size: 0.82rem; font-weight: 700; text-transform: uppercase;
  letter-spacing: 1px; color: var(--text-light);
  margin-bottom: 0.85rem; padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--border-sub);
}
.guide-list { list-style: none; display: flex; flex-direction: column; gap: 10px; }
.guide-list li { display: flex; gap: 10px; font-size: 0.92rem; color: var(--text-gray); line-height: 1.5; align-items: baseline; }
.guide-list li::before { content:"→"; color: var(--primary-gold); font-weight: 700; flex-shrink: 0; }
.guide-list li strong { color: var(--text-light); white-space: nowrap; }
.step-num-inline { color: var(--primary-gold); font-weight: 700; flex-shrink: 0; min-width: 18px; }
.angle-block { margin-bottom: 1rem; }
.angle-block:last-child { margin-bottom: 0; }
.angle-label { font-size: 0.88rem; font-weight: 700; color: var(--text-light); margin-bottom: 0.3rem; }
.angle-desc { font-size: 0.88rem; color: var(--text-gray); line-height: 1.6; }
.phone-tip {
  display: flex; gap: 12px; align-items: flex-start;
  margin-top: 1.5rem; padding: 1rem 1.25rem;
  background: rgba(212,175,55,0.05); border: 1px solid var(--border-gold); border-radius: 2px;
}
.phone-tip-icon { font-size: 1.4rem; flex-shrink: 0; line-height: 1.3; }
.phone-tip p { font-size: 0.95rem; color: var(--text-gray); line-height: 1.65; }
.phone-tip strong { color: var(--text-light); }

/* Upload cards */
.upload-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
.upload-card {
  background: var(--dark-bg);
  border: 1px dashed rgba(212,175,55,0.25);
  border-radius: 3px; position: relative; overflow: hidden;
  transition: border-color 0.2s, background 0.2s;
  cursor: pointer;
}
.upload-card:hover { border-color: var(--primary-gold); background: rgba(212,175,55,0.03); }
.upload-card.has-file { border-style: solid; border-color: var(--primary-gold); }
.upload-card input[type=file] {
  position: absolute; inset: 0; opacity: 0;
  width: 100%; height: 100%; cursor: pointer;
  padding: 0; border: none; background: none;
  font-size: 16px; /* prevents iOS auto-zoom */
}
.upload-inner { padding: 1.75rem 1.25rem; text-align: center; pointer-events: none; }
.upload-emoji { font-size: 2.2rem; display: block; margin-bottom: 0.75rem; }
.upload-name { font-size: 1rem; font-weight: 700; margin-bottom: 0.4rem; color: var(--text-light); }
.upload-what { font-size: 0.88rem; color: var(--text-gray); line-height: 1.6; margin-bottom: 0.6rem; }
.upload-how {
  font-size: 0.82rem; color: var(--text-gray); line-height: 1.55;
  padding-top: 0.6rem; border-top: 1px solid var(--border-sub);
  text-align: left;
}
.upload-how strong { color: var(--primary-gold); }
.upload-cta {
  display: inline-block; margin-top: 1rem;
  padding: 9px 22px; background: var(--accent-grad);
  color: #000; font-size: 0.82rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 1px; border-radius: 2px;
}
.upload-status { font-size: 0.85rem; color: var(--primary-gold); margin-top: 0.6rem; font-weight: 600; }

/* Cardio results (no file input) */
.results-card {
  background: var(--dark-bg);
  border: 1px solid rgba(212,175,55,0.2);
  border-radius: 3px; padding: 1.75rem 1.25rem;
}
.results-card .upload-emoji, .results-card .upload-name { pointer-events: none; }
.results-inner { margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem; }
.results-inner label { font-size: 0.78rem; }

/* Postural checks */
.postural-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 0.75rem; }
.check-pill {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 14px; background: var(--dark-bg);
  border: 1px solid rgba(212,175,55,0.15); border-radius: 2px;
  cursor: pointer; transition: all 0.15s; user-select: none;
  font-size: 0.95rem; color: var(--text-gray);
}
.check-pill.on { border-color: var(--primary-gold); color: var(--text-light); background: rgba(212,175,55,0.06); }
.check-box {
  width: 20px; height: 20px; flex-shrink: 0;
  border: 1px solid rgba(212,175,55,0.3); border-radius: 2px;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.8rem; color: #000; transition: all 0.15s;
}
.check-pill.on .check-box { background: var(--primary-gold); border-color: var(--primary-gold); }

/* ── FORM NAV ─────────────────────────────── */
.form-nav {
  display: flex; justify-content: space-between; align-items: center;
  padding: 1.25rem 5%; border-top: 1px solid var(--border-gold);
  background: rgba(26,26,26,0.97); backdrop-filter: blur(8px);
  position: sticky; bottom: 0; z-index: 50;
}
.step-counter { font-size: 0.88rem; color: var(--text-gray); }

.cta-button {
  display: inline-block; background: var(--accent-grad);
  color: #000; padding: 13px 32px; font-size: 0.95rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 1px; border: none;
  cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border-radius: 2px;
  font-family: inherit;
}
.cta-button:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(212,175,55,0.3); }
.cta-ghost {
  background: none; color: var(--text-gray); padding: 13px 32px;
  font-size: 0.95rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
  border: 1px solid rgba(255,255,255,0.15); cursor: pointer;
  transition: border-color 0.2s, color 0.2s; border-radius: 2px; font-family: inherit;
}
.cta-ghost:hover { border-color: rgba(255,255,255,0.4); color: var(--text-light); }
.cta-submit {
  background: var(--primary-gold); color: #000; padding: 13px 32px;
  font-size: 0.95rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
  border: none; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border-radius: 2px;
  font-family: inherit;
}
.cta-submit:hover { background: #f4d03f; transform: translateY(-2px); box-shadow: 0 8px 24px rgba(212,175,55,0.3); }

/* Submit screen */
.submit-screen {
  display: none; flex-direction: column; align-items: center;
  justify-content: center; min-height: 70vh; padding: 4rem 5%; text-align: center;
}
.submit-screen.active { display: flex; }
.submit-icon { font-size: 4rem; margin-bottom: 1.5rem; }
.submit-screen h2 { font-size: 2.4rem; font-weight: 800; margin-bottom: 1rem; }
.submit-screen h2 span { color: var(--primary-gold); }
.submit-screen p { color: var(--text-gray); max-width: 480px; line-height: 1.8; font-size: 1rem; }
.progress-wrap { width: 320px; height: 4px; background: rgba(255,255,255,0.08); border-radius: 2px; margin: 2rem auto 1rem; overflow: hidden; }
.progress-fill { height: 100%; background: var(--accent-grad); animation: fillbar 3s ease-out forwards; }
@keyframes fillbar { from{width:0} to{width:100%} }
.loading-dots::after { content:''; animation: dots 1.5s infinite; }
@keyframes dots { 0%{content:''} 33%{content:'.'} 66%{content:'..'} 100%{content:'...'} }

/* ═══════════════════════════════════════════
   TRAINER DASHBOARD
═══════════════════════════════════════════ */
.dash-header {
  padding: 3rem 5% 2rem;
  border-bottom: 1px solid var(--border-gold);
  background: linear-gradient(135deg, rgba(212,175,55,0.04) 0%, transparent 60%);
  display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 1rem;
}
.dash-eyebrow { color: var(--primary-gold); font-size: 0.85rem; font-weight: 600; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 0.5rem; }
.dash-header h2 { font-size: 2.2rem; font-weight: 800; }
.logout-btn {
  padding: 9px 22px; background: none; border: 1px solid rgba(255,255,255,0.15);
  color: var(--text-gray); font-family: inherit; font-size: 0.82rem; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1px; cursor: pointer; border-radius: 2px;
  transition: border-color 0.2s, color 0.2s;
}
.logout-btn:hover { border-color: var(--primary-gold); color: var(--primary-gold); }

.client-bar {
  display: flex; align-items: center; gap: 12px;
  padding: 1.25rem 5%; border-bottom: 1px solid var(--border-gold);
  background: var(--dark-bg); overflow-x: auto; -webkit-overflow-scrolling: touch;
}
.client-chip {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 18px; border: 1px solid rgba(255,255,255,0.1);
  border-radius: 100px; cursor: pointer; transition: all 0.2s; flex-shrink: 0;
}
.client-chip.active { border-color: var(--primary-gold); background: rgba(212,175,55,0.08); }
.client-avatar {
  width: 30px; height: 30px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.75rem; font-weight: 700; background: rgba(255,255,255,0.1);
}
.client-chip.active .client-avatar { background: var(--primary-gold); color: #000; }
.client-name { font-size: 0.88rem; white-space: nowrap; }
.client-dot { width: 8px; height: 8px; border-radius: 50%; }
.chip-hint { font-size: 0.82rem; color: var(--text-gray); white-space: nowrap; padding: 0 8px; }

/* AI generate bar */
.ai-bar {
  padding: 1.5rem 5%; border-bottom: 1px solid var(--border-gold);
  display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;
}
.ai-btn {
  display: flex; align-items: center; gap: 10px;
  padding: 13px 28px; border: 1px solid var(--primary-gold);
  background: rgba(212,175,55,0.06); color: var(--primary-gold);
  cursor: pointer; font-family: inherit; font-size: 0.88rem;
  font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
  border-radius: 2px; transition: all 0.2s;
}
.ai-btn:hover { background: rgba(212,175,55,0.12); }
.spinner {
  display: none; width: 14px; height: 14px;
  border: 2px solid rgba(212,175,55,0.3); border-top-color: var(--primary-gold);
  border-radius: 50%; animation: spin 0.7s linear infinite;
}
@keyframes spin { to{transform:rotate(360deg)} }
.ai-note { font-size: 0.88rem; color: var(--text-gray); max-width: 500px; line-height: 1.6; }

.ai-response {
  display: none; padding: 2rem 5%;
  background: rgba(212,175,55,0.03); border-left: 3px solid var(--primary-gold);
}
.ai-response.visible { display: block; }
.ai-response-label { font-size: 0.78rem; letter-spacing: 2px; text-transform: uppercase; color: var(--primary-gold); font-weight: 700; margin-bottom: 1rem; }
.ai-response-text { font-size: 0.95rem; line-height: 1.85; color: var(--text-light); white-space: pre-wrap; }

/* Dashboard grid */
.dash-grid {
  display: grid; grid-template-columns: 1fr 1fr 1fr;
  gap: 1px; background: var(--border-gold); border-top: 1px solid var(--border-gold);
}
.dash-card { background: var(--darker-bg); padding: 2rem; }
.dash-card.wide { grid-column: span 2; }
.dash-card.full { grid-column: span 3; }
.card-label {
  font-size: 0.72rem; letter-spacing: 2px; text-transform: uppercase;
  color: var(--text-gray); font-weight: 600; margin-bottom: 1.25rem;
  display: flex; align-items: center; justify-content: space-between;
}
.badge { padding: 3px 10px; border-radius: 2px; font-size: 0.66rem; letter-spacing: 1px; font-weight: 700; }
.badge-red    { background: rgba(224,82,82,0.12); color: var(--red); border: 1px solid rgba(224,82,82,0.3); }
.badge-amber  { background: rgba(244,162,97,0.12); color: var(--amber); border: 1px solid rgba(244,162,97,0.3); }
.badge-green  { background: rgba(82,183,136,0.12); color: var(--green); border: 1px solid rgba(82,183,136,0.3); }

.flag-list { display: flex; flex-direction: column; gap: 10px; }
.flag-item { display: flex; align-items: flex-start; gap: 12px; padding: 12px 14px; border-radius: 2px; }
.flag-item.red    { background: rgba(224,82,82,0.06); border-left: 2px solid var(--red); }
.flag-item.amber  { background: rgba(244,162,97,0.06); border-left: 2px solid var(--amber); }
.flag-item.green  { background: rgba(82,183,136,0.06); border-left: 2px solid var(--green); }
.flag-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; margin-top: 5px; }
.flag-dot.red   { background: var(--red); }
.flag-dot.amber { background: var(--amber); }
.flag-dot.green { background: var(--green); }
.flag-text { font-size: 0.9rem; line-height: 1.6; }
.flag-src { font-size: 0.76rem; color: var(--text-gray); margin-top: 3px; font-style: italic; }

.findings-table { width: 100%; border-collapse: collapse; }
.findings-table th { font-size: 0.72rem; letter-spacing: 1.5px; text-transform: uppercase; color: var(--text-gray); padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--border-gold); font-weight: 600; }
.findings-table td { padding: 10px 12px; font-size: 0.9rem; border-bottom: 1px solid var(--border-sub); vertical-align: top; }
.findings-table tr:last-child td { border-bottom: none; }
.comp-tag { display: inline-block; padding: 3px 9px; border-radius: 2px; font-size: 0.74rem; background: rgba(244,162,97,0.12); color: var(--amber); border: 1px solid rgba(244,162,97,0.3); }
.mtags { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }
.mtag { padding: 2px 8px; font-size: 0.72rem; border-radius: 2px; }
.mtag.over  { background: rgba(224,82,82,0.1); color: #e08080; }
.mtag.under { background: rgba(82,183,136,0.1); color: #80c9a0; }

.cex-stages { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.cex-stage { padding: 16px; border: 1px solid var(--border-gold); border-radius: 2px; }
.cex-stage-num { font-size: 0.66rem; letter-spacing: 2px; text-transform: uppercase; color: var(--primary-gold); margin-bottom: 4px; font-weight: 700; }
.cex-stage-name { font-size: 0.95rem; font-weight: 700; margin-bottom: 10px; }
.cex-item { font-size: 0.88rem; color: var(--text-gray); padding: 3px 0; display: flex; gap: 8px; }
.cex-item::before { content:"→"; color: var(--primary-gold); font-weight: 700; flex-shrink: 0; }

.stage-track { display: flex; height: 6px; border-radius: 3px; overflow: hidden; margin-bottom: 8px; gap: 2px; }
.stage-seg { flex: 1; background: rgba(255,255,255,0.08); border-radius: 1px; }
.stage-seg.lit { background: var(--primary-gold); }
.stage-lbls { display: flex; justify-content: space-between; margin-bottom: 1.25rem; }
.stage-lbl { font-size: 0.6rem; color: var(--text-gray); text-align: center; flex: 1; }
.stage-current { font-size: 1.3rem; font-weight: 800; margin-bottom: 6px; }
.stage-desc { font-size: 0.9rem; color: var(--text-gray); line-height: 1.7; }
.goal-list { display: flex; flex-direction: column; gap: 10px; margin-top: 1.25rem; }
.goal-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
.goal-bar-bg { flex: 1; height: 3px; background: rgba(255,255,255,0.08); border-radius: 2px; }
.goal-bar { height: 100%; border-radius: 2px; background: var(--accent-grad); }
.goal-score { color: var(--primary-gold); font-size: 0.85rem; font-weight: 700; min-width: 32px; text-align: right; }

.empty-state { grid-column: span 3; padding: 5rem 2rem; text-align: center; color: var(--text-gray); }
.empty-state h3 { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.75rem; color: var(--text-light); }
.empty-state p { font-size: 0.95rem; line-height: 1.8; max-width: 400px; margin: 0 auto; }

/* Footer */
footer { background: var(--darker-bg); border-top: 1px solid var(--border-gold); padding: 3rem 5%; text-align: center; }
.footer-logo { font-size: 1.75rem; font-weight: 700; color: var(--primary-gold); letter-spacing: 2px; margin-bottom: 0.75rem; }
.footer-tagline { color: var(--text-gray); font-size: 0.95rem; margin-bottom: 1.5rem; }
.footer-bottom { margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-sub); color: var(--text-gray); font-size: 0.85rem; }

/* Responsive */
@media (max-width: 768px) {
  .form-grid { grid-template-columns: 1fr; }
  .form-grid.three { grid-template-columns: 1fr 1fr; }
  .field.span2, .field.span3 { grid-column: span 1; }
  .guide-grid { grid-template-columns: 1fr; }
  .upload-grid { grid-template-columns: 1fr; }
  .postural-grid { grid-template-columns: 1fr; }
  .dash-grid { grid-template-columns: 1fr; }
  .dash-card.wide, .dash-card.full { grid-column: span 1; }
  .cex-stages { grid-template-columns: 1fr; }
  .ai-bar { flex-direction: column; align-items: flex-start; }
  .scale-row .scale-lbl { min-width: 100%; }
  .dash-header { flex-direction: column; align-items: flex-start; }
}
</style>
</head>
<body>

<!-- ═══ HEADER ════════════════════════════ -->
<header>
  <nav>
    <a href="index.html" class="logo"><span class="logo-slash">//</span>EC FITNESS</a>
    <div class="nav-links" id="navLinks">
      <a href="index.html#approach">Approach</a>
      <a href="index.html#services">Services</a>
      <a href="index.html#credentials">About</a>
      <a href="ai-trainer.html">AI Training</a>
      <a href="booking.html">Book Session</a>
    </div>
    <button class="mobile-menu-btn" id="menuBtn">☰</button>
  </nav>
</header>


<!-- ═══════════════════════════════════════
     VIEW 1 — PORTAL ENTRY (Login / Intake choice)
═══════════════════════════════════════ -->
<div class="view active" id="view-entry">
  <div class="portal-entry">

    <!-- Intake choice screen -->
    <div id="choiceScreen" style="width:100%; max-width:480px;">
      <div class="entry-card">
        <a href="index.html" class="entry-logo" style="text-decoration:none; display:block;"><span style="color:#fff">//</span>EC FITNESS</a>
        <div class="entry-sub">Pre-Session Intake &amp; Trainer Portal</div>

        <button class="cta-button" style="width:100%; font-size:1rem; padding:16px;" onclick="showView('intake')">
          Begin Client Intake →
        </button>

        <div class="entry-divider">or</div>

        <button class="cta-ghost" style="width:100%;" onclick="showScreen('loginScreen')">
          Trainer Login
        </button>
      </div>
    </div>

    <!-- Trainer login screen -->
    <div id="loginScreen" style="display:none; width:100%; max-width:480px;">
      <div class="entry-card">
        <a href="index.html" class="entry-logo" style="text-decoration:none; display:block;"><span style="color:#fff">//</span>EC FITNESS</a>
        <div class="entry-sub">Trainer Dashboard Access</div>

        <div class="lfield">
          <label>Email</label>
          <input type="email" id="loginEmail" placeholder="Enter your email" autocomplete="email" />
        </div>
        <div class="lfield">
          <label>Password</label>
          <input type="password" id="loginPw" placeholder="••••••••••" autocomplete="current-password"
            onkeydown="if(event.key==='Enter') attemptLogin()" />
        </div>
        <button class="cta-button" style="width:100%;" onclick="attemptLogin()">Sign In →</button>
        <div class="login-err" id="loginErr">Incorrect email or password.</div>
        <p style="margin-top:1.25rem; text-align:center; font-size:0.85rem;">
          <a href="#" onclick="showScreen('choiceScreen')" style="color:var(--primary-gold); text-decoration:none;">← Back</a>
        </p>
      </div>
    </div>

    <!-- 2FA screen -->
    <div id="tfaScreen" style="display:none; width:100%; max-width:480px;">
      <div class="entry-card">
        <a href="index.html" class="entry-logo" style="text-decoration:none; display:block;"><span style="color:#fff">//</span>EC FITNESS</a>
        <div class="entry-sub">Two-Step Verification</div>
        <p class="tfa-hint" id="tfaHint">A 6-digit code was sent to your email. Enter it below to access the trainer dashboard.</p>
        <div class="tfa-row" id="tfaRow">
          <input class="tfa-digit" maxlength="1" type="tel" inputmode="numeric" pattern="[0-9]*" />
          <input class="tfa-digit" maxlength="1" type="tel" inputmode="numeric" pattern="[0-9]*" />
          <input class="tfa-digit" maxlength="1" type="tel" inputmode="numeric" pattern="[0-9]*" />
          <input class="tfa-digit" maxlength="1" type="tel" inputmode="numeric" pattern="[0-9]*" />
          <input class="tfa-digit" maxlength="1" type="tel" inputmode="numeric" pattern="[0-9]*" />
          <input class="tfa-digit" maxlength="1" type="tel" inputmode="numeric" pattern="[0-9]*" />
        </div>
        <button class="cta-button" style="width:100%;" onclick="verifyTFA()">Verify &amp; Enter →</button>
        <div class="login-err" id="tfaErr">Incorrect code. Please try again.</div>
        <p class="tfa-resend">Didn't receive it? <a onclick="resendCode()">Resend code</a></p>
      </div>
    </div>

  </div>
</div><!-- end view-entry -->


<!-- ═══════════════════════════════════════
     VIEW 2 — CLIENT INTAKE FORM
═══════════════════════════════════════ -->
<div class="view" id="view-intake">

  <div class="intake-hero">
    <div class="intake-eyebrow">EC Fitness · Pre-Session Assessment</div>
    <h1>Your assessment, <span>before we meet.</span></h1>
    <p>Complete this at your own pace. Edgar reviews your data and health history before your first session — so every minute together is pure training, not paperwork.</p>
  </div>

  <!-- Stepper -->
  <div class="stepper" id="stepper">
    <div class="step active" id="step-0"><div class="step-num">1</div><div class="step-label">PAR-Q+</div></div>
    <div class="step-line"></div>
    <div class="step" id="step-1"><div class="step-num">2</div><div class="step-label">Health History</div></div>
    <div class="step-line"></div>
    <div class="step" id="step-2"><div class="step-num">3</div><div class="step-label">Body Comp</div></div>
    <div class="step-line"></div>
    <div class="step" id="step-3"><div class="step-num">4</div><div class="step-label">Goals</div></div>
    <div class="step-line"></div>
    <div class="step" id="step-4"><div class="step-num">5</div><div class="step-label">Assessments</div></div>
  </div>

  <!-- ── STEP 0: PAR-Q+ ──────────────────── -->
  <div class="form-section active" id="section-0">
    <div class="section-wrap">
      <div class="section-eyebrow">Step 1 of 5</div>
      <div class="section-title">PAR-Q+ Health Screening</div>
      <div class="section-subtitle">2023 Physical Activity Readiness Questionnaire · Read each question carefully and answer honestly.</div>

      <div class="parq-item">
        <div class="parq-text">1. Has your doctor ever said that you have a <strong>heart condition</strong> OR <strong>high blood pressure</strong>?</div>
        <div class="yn-wrap">
          <button class="yn-btn yes" onclick="toggleYN(this,'q1','yes')">YES</button>
          <button class="yn-btn no sel" onclick="toggleYN(this,'q1','no')">NO</button>
        </div>
      </div>

      <div class="parq-item">
        <div class="parq-text">2. Do you feel <strong>pain in your chest</strong> at rest, during daily activities, or when you do physical activity?</div>
        <div class="yn-wrap">
          <button class="yn-btn yes" onclick="toggleYN(this,'q2','yes')">YES</button>
          <button class="yn-btn no sel" onclick="toggleYN(this,'q2','no')">NO</button>
        </div>
      </div>

      <div class="parq-item">
        <div class="parq-text">3. Do you <strong>lose balance because of dizziness</strong> OR have you lost consciousness in the last 12 months?</div>
        <div class="yn-wrap">
          <button class="yn-btn yes" onclick="toggleYN(this,'q3','yes')">YES</button>
          <button class="yn-btn no sel" onclick="toggleYN(this,'q3','no')">NO</button>
        </div>
      </div>

      <div class="parq-item" style="flex-direction:column; gap:0.6rem;">
        <div style="display:flex; gap:1rem; align-items:flex-start;">
          <div class="parq-text">4. Have you ever been diagnosed with <strong>another chronic medical condition</strong> (other than heart disease or high blood pressure)?</div>
          <div class="yn-wrap">
            <button class="yn-btn yes" onclick="toggleYN(this,'q4','yes')">YES</button>
            <button class="yn-btn no sel" onclick="toggleYN(this,'q4','no')">NO</button>
          </div>
        </div>
        <input class="parq-detail" id="q4-detail" placeholder="Please list condition(s) here…" />
      </div>

      <div class="parq-item" style="flex-direction:column; gap:0.6rem;">
        <div style="display:flex; gap:1rem; align-items:flex-start;">
          <div class="parq-text">5. Are you currently taking <strong>prescribed medications</strong> for a chronic medical condition?</div>
          <div class="yn-wrap">
            <button class="yn-btn yes" onclick="toggleYN(this,'q5','yes')">YES</button>
            <button class="yn-btn no sel" onclick="toggleYN(this,'q5','no')">NO</button>
          </div>
        </div>
        <input class="parq-detail" id="q5-detail" placeholder="Please list condition(s) and medications…" />
      </div>

      <div class="parq-item" style="flex-direction:column; gap:0.6rem;">
        <div style="display:flex; gap:1rem; align-items:flex-start;">
          <div class="parq-text">6. Do you currently have a <strong>bone, joint, or soft tissue problem</strong> that could be made worse by becoming more physically active?</div>
          <div class="yn-wrap">
            <button class="yn-btn yes" onclick="toggleYN(this,'q6','yes')">YES</button>
            <button class="yn-btn no sel" onclick="toggleYN(this,'q6','no')">NO</button>
          </div>
        </div>
        <input class="parq-detail" id="q6-detail" placeholder="Please list condition(s) here…" />
      </div>

      <div class="parq-item">
        <div class="parq-text">7. Has your doctor ever said that you should only do <strong>medically supervised physical activity</strong>?</div>
        <div class="yn-wrap">
          <button class="yn-btn yes" onclick="toggleYN(this,'q7','yes')">YES</button>
          <button class="yn-btn no sel" onclick="toggleYN(this,'q7','no')">NO</button>
        </div>
      </div>

      <hr class="divider">
      <div class="subsection-label">Participant Declaration</div>
      <div class="form-grid">
        <div class="field"><label>Full Name</label><input type="text" id="parq-name" placeholder="Your full legal name" autocomplete="name" /></div>
        <div class="field"><label>Date</label><input type="date" id="parq-date" /></div>
      </div>
    </div>
  </div>

  <!-- ── STEP 1: HEALTH HISTORY ──────────── -->
  <div class="form-section" id="section-1">
    <div class="section-wrap">
      <div class="section-eyebrow">Step 2 of 5</div>
      <div class="section-title">Lifestyle &amp; Health History</div>
      <div class="section-subtitle">NASM CPT7 standard · Your answers directly shape your corrective protocol and program design.</div>

      <div class="subsection-label">Personal Information</div>
      <div class="form-grid">
        <div class="field"><label>Full Name</label><input type="text" id="hh-name" placeholder="First Last" autocomplete="name" /></div>
        <div class="field"><label>Age</label><input type="number" id="hh-age" placeholder="Years" min="16" max="99" oninput="calcHRmax()" /></div>
        <div class="field"><label>Gender</label>
          <select id="hh-gender"><option value="">Select…</option><option>Male</option><option>Female</option><option>Non-binary</option><option>Prefer not to say</option></select>
        </div>
        <div class="field"><label>Occupation</label><input type="text" id="hh-occ" placeholder="Job title / role" /></div>
        <div class="field"><label>Physician Name &amp; Phone</label><input type="text" id="hh-doc" placeholder="Dr. Smith · (214) 555-0100" /></div>
        <div class="field"><label>Emergency Contact</label><input type="text" id="hh-emerg" placeholder="Name · Phone number" /></div>
      </div>

      <hr class="divider">
      <div class="subsection-label">Exercise &amp; Activity</div>
      <div class="form-grid one">
        <div class="field"><label>Current exercise activities</label><input type="text" id="hh-exercise" placeholder="e.g., running 3×/week, weightlifting, yoga, group fitness…" /></div>
        <div class="field"><label>Days per week with 60+ minutes of moderate exercise</label><input type="number" id="hh-days" placeholder="0–7" min="0" max="7" /></div>
      </div>

      <hr class="divider">
      <div class="subsection-label">Lifestyle</div>
      <div class="form-grid">
        <div class="field">
          <label>Do you get enough sleep most nights?</label>
          <div class="pill-group" style="margin-top:4px;">
            <div class="pill" onclick="pickPill(this,'sleep')">Yes</div>
            <div class="pill" onclick="pickPill(this,'sleep')">No</div>
            <div class="pill" onclick="pickPill(this,'sleep')">Sometimes</div>
          </div>
        </div>
        <div class="field">
          <label>Do you smoke or use a vaporizer?</label>
          <div class="pill-group" style="margin-top:4px;">
            <div class="pill" onclick="pickPill(this,'smoke')">Yes</div>
            <div class="pill" onclick="pickPill(this,'smoke')">No</div>
            <div class="pill" onclick="pickPill(this,'smoke')">Occasionally</div>
          </div>
        </div>
        <div class="field">
          <label>Average stress level</label>
          <div class="scale-row" style="margin-top:8px;">
            <span class="scale-lbl">0 = none · 10 = extreme</span>
            <input type="range" min="0" max="10" value="5" oninput="document.getElementById('sval').textContent=this.value">
            <span class="scale-val" id="sval">5</span>
          </div>
        </div>
        <div class="field"><label>Alcoholic drinks per week</label><input type="number" id="hh-alc" placeholder="0" min="0" /></div>
        <div class="field span2"><label>How do you manage stress?</label><input type="text" id="hh-stress" placeholder="e.g., meditation, walks, reading, nothing currently…" /></div>
      </div>

      <hr class="divider">
      <div class="subsection-label">Occupation &amp; Daily Habits</div>
      <div class="form-grid">
        <div class="field">
          <label>Does your job require extended sitting?</label>
          <div class="pill-group" style="margin-top:4px;">
            <div class="pill" onclick="pickPill(this,'sit')">Yes</div>
            <div class="pill" onclick="pickPill(this,'sit')">No</div>
            <div class="pill" onclick="pickPill(this,'sit')">Mixed</div>
          </div>
        </div>
        <div class="field">
          <label>Does your job involve repetitive movements?</label>
          <div class="pill-group" style="margin-top:4px;">
            <div class="pill" onclick="pickPill(this,'rep')">Yes</div>
            <div class="pill" onclick="pickPill(this,'rep')">No</div>
          </div>
        </div>
        <div class="field">
          <label>Do you regularly wear heeled footwear?</label>
          <div class="pill-group" style="margin-top:4px;">
            <div class="pill" onclick="pickPill(this,'heel')">Yes</div>
            <div class="pill" onclick="pickPill(this,'heel')">No</div>
            <div class="pill" onclick="pickPill(this,'heel')">Sometimes</div>
          </div>
        </div>
        <div class="field"><label>Recreational activities (golf, skiing, etc.)</label><input type="text" id="hh-rec" placeholder="List activities, or 'None'" /></div>
      </div>

      <hr class="divider">
      <div class="subsection-label">Medical History</div>
      <div class="form-grid one">
        <div class="field"><label>Past musculoskeletal injuries</label><textarea id="hh-inj" placeholder="e.g., ACL tear (2019, right knee), left shoulder impingement (2022)… or 'None'"></textarea></div>
        <div class="field"><label>Past surgeries</label><textarea id="hh-surg" placeholder="List surgeries and approximate dates… or 'None'"></textarea></div>
        <div class="field"><label>Chronic health conditions</label><textarea id="hh-cond" placeholder="e.g., hypertension, Type 2 diabetes, asthma… or 'None'"></textarea></div>
        <div class="field"><label>Current medications</label><textarea id="hh-meds" placeholder="List medications and dosages… or 'None'"></textarea></div>
      </div>
    </div>
  </div>

  <!-- ── STEP 2: BODY COMPOSITION ────────── -->
  <div class="form-section" id="section-2">
    <div class="section-wrap">
      <div class="section-eyebrow">Step 3 of 5</div>
      <div class="section-title">Body Composition</div>
      <div class="section-subtitle">Self-reported measurements · Use a flexible tape measure for circumferences. BMI and Waist-to-Hip Ratio are calculated automatically.</div>

      <div class="subsection-label">Basic Metrics</div>
      <div class="form-grid three">
        <div class="field"><label>Height (inches)</label><input type="number" id="bc-ht" placeholder="e.g., 68" oninput="calcBMI()" /></div>
        <div class="field"><label>Weight (lbs)</label><input type="number" id="bc-wt" placeholder="e.g., 165" oninput="calcBMI()" /></div>
        <div class="field"><label>BMI — Auto-Calculated</label><input type="text" id="bc-bmi" class="auto-field" placeholder="Fill height &amp; weight" readonly /></div>
      </div>

      <hr class="divider">
      <div class="subsection-label">Circumference Measurements (inches)</div>
      <div class="form-grid three">
        <div class="field"><label>Neck</label><input type="number" id="c-neck" placeholder="0.0" step="0.1" /></div>
        <div class="field"><label>Chest</label><input type="number" id="c-chest" placeholder="0.0" step="0.1" /></div>
        <div class="field"><label>Arms</label><input type="number" id="c-arms" placeholder="0.0" step="0.1" /></div>
        <div class="field"><label>Waist</label><input type="number" id="c-waist" placeholder="0.0" step="0.1" oninput="calcWHR()" /></div>
        <div class="field"><label>Hips</label><input type="number" id="c-hips" placeholder="0.0" step="0.1" oninput="calcWHR()" /></div>
        <div class="field"><label>Thighs</label><input type="number" id="c-thighs" placeholder="0.0" step="0.1" /></div>
        <div class="field"><label>Calves</label><input type="number" id="c-calves" placeholder="0.0" step="0.1" /></div>
        <div class="field"><label>Waist-to-Hip Ratio — Auto</label><input type="text" id="bc-whr" class="auto-field" placeholder="Fill waist &amp; hips" readonly /></div>
      </div>

      <hr class="divider">
      <div class="subsection-label">Resting Vitals</div>
      <div class="form-grid three">
        <div class="field"><label>Resting Heart Rate (bpm)</label><input type="number" id="bc-rhr" placeholder="e.g., 68" /></div>
        <div class="field"><label>Blood Pressure (if known)</label><input type="text" id="bc-bp" placeholder="e.g., 120/80" /></div>
        <div class="field"><label>HRmax Estimate (220 − Age)</label><input type="text" id="bc-hrmax" class="auto-field" placeholder="Fill age in Step 2" readonly /></div>
      </div>
    </div>
  </div>

  <!-- ── STEP 3: GOALS ────────────────────── -->
  <div class="form-section" id="section-3">
    <div class="section-wrap">
      <div class="section-eyebrow">Step 4 of 5</div>
      <div class="section-title">Goals &amp; Fitness Priorities</div>
      <div class="section-subtitle">Your goals directly shape your program. Be as specific and honest as possible.</div>

      <div class="subsection-label">Goal Importance (0 = Not a priority · 10 = Critical)</div>
      <div style="display:flex; flex-direction:column; gap:1.25rem; margin-bottom:2.25rem;">
        <div class="scale-row"><span class="scale-lbl">Weight Loss / Fat Loss</span><input type="range" min="0" max="10" value="5" oninput="document.getElementById('g1v').textContent=this.value"><span class="scale-val" id="g1v">5</span></div>
        <div class="scale-row"><span class="scale-lbl">Muscle Gain / Hypertrophy</span><input type="range" min="0" max="10" value="5" oninput="document.getElementById('g2v').textContent=this.value"><span class="scale-val" id="g2v">5</span></div>
        <div class="scale-row"><span class="scale-lbl">Sports Performance</span><input type="range" min="0" max="10" value="5" oninput="document.getElementById('g3v').textContent=this.value"><span class="scale-val" id="g3v">5</span></div>
        <div class="scale-row"><span class="scale-lbl">Overall Health Improvement</span><input type="range" min="0" max="10" value="5" oninput="document.getElementById('g4v').textContent=this.value"><span class="scale-val" id="g4v">5</span></div>
        <div class="scale-row"><span class="scale-lbl">Pain Relief / Corrective Exercise</span><input type="range" min="0" max="10" value="5" oninput="document.getElementById('g5v').textContent=this.value"><span class="scale-val" id="g5v">5</span></div>
      </div>

      <hr class="divider">
      <div class="subsection-label">In Your Own Words</div>
      <div class="form-grid one">
        <div class="field"><label>What is the #1 outcome you want from training?</label><textarea id="goal-main" style="min-height:110px;" placeholder="Be specific — e.g., 'I want to lose 20 lbs before my MBA graduation in May and reduce the lower back pain that's been getting worse from sitting 9 hours a day.'"></textarea></div>
        <div class="field"><label>Timeline / Key Dates</label><input type="text" id="goal-time" placeholder="e.g., 16 weeks, event on June 15th, no hard deadline" /></div>
        <div class="field"><label>Training availability</label><input type="text" id="goal-avail" placeholder="e.g., 4 days/week · mornings before 8am or evenings after 7pm" /></div>
        <div class="field"><label>Any constraints or concerns?</label><textarea id="goal-constraints" placeholder="e.g., travel 2 weeks/month, right knee bothers me on stairs, apartment gym only…"></textarea></div>
      </div>

      <hr class="divider">
      <div class="subsection-label">Your Stage of Readiness</div>
      <p style="font-size:0.95rem; color:var(--text-gray); margin-bottom:1.25rem; line-height:1.7;">Which best describes where you are right now?</p>
      <div class="pill-group" style="flex-direction:column; gap:10px;">
        <div class="pill" onclick="pickPill(this,'stage')" style="text-align:left; padding:14px 20px;"><strong>Pre-contemplation</strong> &nbsp;—&nbsp; I'm not really thinking about making a change yet.</div>
        <div class="pill" onclick="pickPill(this,'stage')" style="text-align:left; padding:14px 20px;"><strong>Contemplation</strong> &nbsp;—&nbsp; I'm thinking about it but haven't committed yet.</div>
        <div class="pill" onclick="pickPill(this,'stage')" style="text-align:left; padding:14px 20px;"><strong>Preparation</strong> &nbsp;—&nbsp; I'm planning to start soon and am getting ready.</div>
        <div class="pill" onclick="pickPill(this,'stage')" style="text-align:left; padding:14px 20px;"><strong>Action</strong> &nbsp;—&nbsp; I've already started making changes.</div>
        <div class="pill" onclick="pickPill(this,'stage')" style="text-align:left; padding:14px 20px;"><strong>Maintenance</strong> &nbsp;—&nbsp; I've been consistent for 6+ months and want to level up.</div>
      </div>
    </div>
  </div>

  <!-- ── STEP 4: MOVEMENT ASSESSMENTS ────── -->
  <div class="form-section" id="section-4">
    <div class="section-wrap" style="max-width:980px;">
      <div class="section-eyebrow">Step 5 of 5</div>
      <div class="section-title">Movement Assessments</div>
      <div class="section-subtitle">Upload short videos for each movement. Edgar performs AI-assisted biomechanical analysis from your footage before your first session — no in-person assessment needed.</div>

      <!-- ── HOW TO RECORD — clear, scannable instructions ── -->
      <div class="video-guide">
        <div class="video-guide-title">📋 How to Record Your Videos</div>
        <div class="guide-grid">
        <div class="guide-col">
            <h4>Before You Record</h4>
            <div class="angle-block">
              <div class="angle-label">Step 1</div>
              <div class="angle-desc">Wear form-fitting clothing — shorts and a fitted top so your joints are clearly visible.</div>
            </div>
            <div class="angle-block">
              <div class="angle-label">Step 2</div>
              <div class="angle-desc">Prop your phone against a wall or chair, or use a stand. Keep it stable and hands-free.</div>
            </div>
            <div class="angle-block">
              <div class="angle-label">Step 3</div>
              <div class="angle-desc">Make sure your full body is in frame — head to toe, with a little room on each side.</div>
            </div>
            <div class="angle-block">
              <div class="angle-label">Step 4</div>
              <div class="angle-desc">Film in good lighting. Near a window or outdoors works perfectly.</div>
            </div>
            <div class="angle-block">
              <div class="angle-label">Step 5</div>
              <div class="angle-desc">Do 5 reps per movement and keep each clip to 15–30 seconds.</div>
            </div>
          </div>
          <div class="guide-col">
            <h4>Camera Angles Explained</h4>
            <div class="angle-block">
              <div class="angle-label">📷 Front View (Anterior)</div>
              <div class="angle-desc">Camera faces you directly from the front. Shows whether your knees cave in or your feet turn out.</div>
            </div>
            <div class="angle-block">
              <div class="angle-label">📷 Side View (Lateral)</div>
              <div class="angle-desc">Camera is directly to your side. Shows forward lean, low back arch, and shoulder position.</div>
            </div>
            <div class="angle-block">
              <div class="angle-label">📌 Most assessments need both angles.</div>
              <div class="angle-desc">Film the front view first, then reposition and film the side. Each card below tells you exactly which angles to use.</div>
            </div>
          </div>
        </div>
        <div class="phone-tip">
          <div class="phone-tip-icon">📱</div>
          <p><strong>On your phone?</strong> Tap any button below — your camera roll opens automatically so you can pick an existing video or record a new one on the spot. No app needed. Just tap, select, and you're done.</p>
        </div>
      </div>

      <!-- Upload cards -->
      <div class="upload-grid">

        <div class="upload-card" id="card-ohsa">
          <input type="file" accept="video/*" onchange="uploaded(this,'card-ohsa','st-ohsa')" />
          <div class="upload-inner">
            <span class="upload-emoji">🏋️</span>
            <div class="upload-name">Overhead Squat (OHSA)</div>
            <div class="upload-what">Arms fully extended overhead · Squat to parallel depth</div>
            <div class="upload-how">
              <strong>Front view:</strong> Shows knee &amp; foot alignment<br>
              <strong>Side view:</strong> Shows back arch &amp; forward lean<br>
              Film both angles · 5 reps each
            </div>
            <div class="upload-cta">Tap to Upload Video</div>
            <div class="upload-status" id="st-ohsa"></div>
          </div>
        </div>

        <div class="upload-card" id="card-slsa">
          <input type="file" accept="video/*" onchange="uploaded(this,'card-slsa','st-slsa')" />
          <div class="upload-inner">
            <span class="upload-emoji">🦵</span>
            <div class="upload-name">Single-Leg Squat (SLSA)</div>
            <div class="upload-what">Balance on one leg · Squat to 60° · Left leg first, then right</div>
            <div class="upload-how">
              <strong>Front view only</strong> · Camera faces you directly<br>
              3 reps per leg · film each leg separately
            </div>
            <div class="upload-cta">Tap to Upload Video</div>
            <div class="upload-status" id="st-slsa"></div>
          </div>
        </div>

        <div class="upload-card" id="card-push">
          <input type="file" accept="video/*" onchange="uploaded(this,'card-push','st-push')" />
          <div class="upload-inner">
            <span class="upload-emoji">💪</span>
            <div class="upload-name">Pushing Assessment</div>
            <div class="upload-what">Push-up or wall push · 5 reps at a controlled pace</div>
            <div class="upload-how">
              <strong>Side view only</strong> · Camera at your side<br>
              This shows whether your shoulders elevate or low back arches
            </div>
            <div class="upload-cta">Tap to Upload Video</div>
            <div class="upload-status" id="st-push"></div>
          </div>
        </div>

        <div class="upload-card" id="card-pull">
          <input type="file" accept="video/*" onchange="uploaded(this,'card-pull','st-pull')" />
          <div class="upload-inner">
            <span class="upload-emoji">🤸</span>
            <div class="upload-name">Pulling Assessment</div>
            <div class="upload-what">Band pull-apart, cable row, or seated row · 5 reps</div>
            <div class="upload-how">
              <strong>Side view only</strong> · Camera at your side<br>
              Shows scapular retraction and shoulder blade movement
            </div>
            <div class="upload-cta">Tap to Upload Video</div>
            <div class="upload-status" id="st-pull"></div>
          </div>
        </div>

        <div class="upload-card" id="card-cardio">
          <input type="file" accept="video/*" onchange="uploaded(this,'card-cardio','st-cardio')" />
          <div class="upload-inner">
            <span class="upload-emoji">❤️</span>
            <div class="upload-name">Cardio Test</div>
            <div class="upload-what">YMCA 3-Min Step Test or Rockport Walk Test</div>
            <div class="upload-how">
              Film your <strong>form and effort</strong> during the test<br>
              Enter your results in the card to the right →
            </div>
            <div class="upload-cta">Tap to Upload Video</div>
            <div class="upload-status" id="st-cardio"></div>
          </div>
        </div>

        <!-- Cardio results — text fields only -->
        <div class="results-card">
          <span class="upload-emoji">📋</span>
          <div class="upload-name" style="font-size:1rem; font-weight:700; margin-bottom:0.25rem;">Cardio Test Results</div>
          <div class="upload-what" style="font-size:0.88rem; color:var(--text-gray);">Enter your numbers after completing the test</div>
          <div class="results-inner">
            <div class="field">
              <label>Test Type</label>
              <select id="cardio-type">
                <option>YMCA 3-Min Step Test</option>
                <option>Rockport Walk Test</option>
                <option>1.5 Mile Run</option>
                <option>VT1 / VT2 Talk Test</option>
              </select>
            </div>
            <div class="field">
              <label>Recovery Heart Rate (bpm)</label>
              <input type="number" id="cardio-hr" placeholder="e.g., 110" />
            </div>
            <div class="field">
              <label>Completion Time (if applicable)</label>
              <input type="text" id="cardio-time" placeholder="e.g., 14:32" />
            </div>
          </div>
        </div>

      </div><!-- end upload-grid -->

      <hr class="divider">
      <div class="subsection-label">Static Postural Observations</div>
      <p style="font-size:0.95rem; color:var(--text-gray); margin-bottom:1rem; line-height:1.7;">Check any that you notice about yourself in the mirror or during daily movement.</p>
      <div class="postural-grid">
        <div class="check-pill" onclick="toggleCheck(this)"><div class="check-box"></div>Flat feet / arches collapse inward</div>
        <div class="check-pill" onclick="toggleCheck(this)"><div class="check-box"></div>Feet turn outward when I stand or walk</div>
        <div class="check-pill" onclick="toggleCheck(this)"><div class="check-box"></div>Knees cave inward (especially when squatting)</div>
        <div class="check-pill" onclick="toggleCheck(this)"><div class="check-box"></div>I lean excessively forward when squatting</div>
        <div class="check-pill" onclick="toggleCheck(this)"><div class="check-box"></div>My lower back arches a lot</div>
        <div class="check-pill" onclick="toggleCheck(this)"><div class="check-box"></div>Shoulders round forward at rest</div>
        <div class="check-pill" onclick="toggleCheck(this)"><div class="check-box"></div>Head juts forward from my shoulders</div>
        <div class="check-pill" onclick="toggleCheck(this)"><div class="check-box"></div>One shoulder sits noticeably higher than the other</div>
      </div>

      <hr class="divider">
      <div class="field">
        <label>Additional notes for Edgar</label>
        <textarea id="notes" placeholder="Any pain, tightness, or limitations you noticed during these assessments. The more detail, the better." style="min-height:100px;"></textarea>
      </div>
    </div>
  </div>

  <!-- Submit confirmation screen -->
  <div class="submit-screen" id="submit-screen">
    <div class="submit-icon">✅</div>
    <h2>Intake <span>Complete.</span></h2>
    <p>Your assessment has been submitted. Edgar has been notified and will review your data before reaching out to confirm next steps and payment details.</p>
    <div class="progress-wrap"><div class="progress-fill"></div></div>
    <p id="notify-status" style="margin-top:0.5rem; font-size:0.88rem; color:var(--text-gray);">Saving your submission...</p>
    <br>
    <a href="ai-trainer.html" style="display:inline-block; margin-top:1rem; color:var(--primary-gold); text-decoration:none; font-size:0.9rem;">← Back to AI Training page</a>
  </div>

  <!-- Form navigation -->
  <div class="form-nav" id="form-nav">
    <button class="cta-ghost" id="btn-back" onclick="prevStep()" style="visibility:hidden;">← Back</button>
    <span class="step-counter" id="step-counter">Step 1 of 5</span>
    <button class="cta-button" id="btn-next" onclick="nextStep()">Continue →</button>
  </div>

</div><!-- end view-intake -->


<!-- ═══════════════════════════════════════
     VIEW 3 — TRAINER DASHBOARD
═══════════════════════════════════════ -->
<div class="view" id="view-trainer">

  <div class="dash-header">
    <div>
      <div class="dash-eyebrow">EC Fitness · Trainer Console</div>
      <h2>Pre-Session Client Briefings</h2>
    </div>
    <button class="logout-btn" onclick="logout()">Sign Out</button>
  </div>

  <div class="client-bar">
    <div class="client-chip active" onclick="selectClient(this,'demo')" id="chip-demo">
      <div class="client-avatar">JM</div>
      <span class="client-name">Jordan M. · Demo</span>
      <div class="client-dot" style="background:var(--amber);"></div>
    </div>
    <span class="chip-hint">← Submitted clients appear here</span>
  </div>

  <div class="ai-bar">
    <div style="margin-bottom:0.75rem;">
      <input type="password" id="runtime-api-key" placeholder="🔑 Paste Anthropic API key here to activate AI Analysis" style="
        width:100%; box-sizing:border-box; padding:0.75rem 1rem;
        background:#1a1a1a; border:2px solid #D4AF37; border-radius:6px;
        color:#fff; font-size:0.9rem; font-family:inherit;
        outline:none;
      " />
    </div>
    <div style="display:flex; align-items:center; gap:0.75rem; flex-wrap:wrap;">
      <button class="ai-btn" id="ai-btn" onclick="generateAI()">
        <div class="spinner" id="spinner"></div>
        ◆ Generate AI Analysis
      </button>
      <div class="ai-note">Runs the EC Fitness AI Specialist protocol: biomechanical review → risk flags → CEX protocol → behavior stage coaching approach.</div>
    </div>
  </div>

  <div class="ai-response" id="ai-response">
    <div class="ai-response-label">◆ EC Fitness AI Specialist · Analysis Report</div>
    <div class="ai-response-text" id="ai-text"></div>
  </div>

  <div class="dash-grid" id="dash-grid">
    <div class="empty-state">
      <h3>Select a client to view their briefing</h3>
      <p>Choose a submitted client from the bar above, or use the Demo client to preview the dashboard.</p>
    </div>
  </div>

  <footer>
    <a href="index.html" class="footer-logo" style="text-decoration:none; display:block;"><span style="color:#fff">//</span>EC FITNESS</a>
    <p class="footer-tagline">Biomechanic Analysis &amp; Research-Grounded Fitness Programming</p>
    <div class="footer-bottom"><p>&copy; 2026 EC Fitness. All rights reserved.</p></div>
  </footer>

</div><!-- end view-trainer -->


<!-- ═══════════════ SCRIPTS ═══════════════ -->
<script>
// ── SUPABASE CLIENT ───────────────────────
const { createClient } = supabase;
const sb = createClient(
  'https://oxcuqmjiaarlhakbjwcv.supabase.co',
  'sb_publishable_6f-AY69d0xZGNCMBcZ41Kw_S-RDJagN'
);

let pendingEmail = ''; // holds email between password step and OTP step

// ── VIEW + SCREEN MANAGEMENT ──────────────
function showView(v) {
  document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
  document.getElementById('view-' + v).classList.add('active');
  window.scrollTo(0,0);
}
function showScreen(id) {
  ['choiceScreen','loginScreen','tfaScreen'].forEach(s => {
    document.getElementById(s).style.display = s === id ? 'block' : 'none';
  });
}

// ── AUTH — Supabase powered ───────────────
async function attemptLogin() {
  const email = document.getElementById('loginEmail').value.trim();
  const pw    = document.getElementById('loginPw').value;
  const err   = document.getElementById('loginErr');
  err.style.display = 'none';

  // Step 1: verify password against Supabase (server-side — no hardcoded credentials)
  const { data, error } = await sb.auth.signInWithPassword({ email, password: pw });

  if (error) {
    err.textContent = 'Incorrect email or password.';
    err.style.display = 'block';
    document.getElementById('loginPw').value = '';
    return;
  }

  // Step 2: sign out immediately — we'll re-authenticate after OTP verification
  await sb.auth.signOut();
  pendingEmail = email;

  // Step 3: send OTP email as second factor via Supabase
  await sb.auth.signInWithOtp({
    email,
    options: { shouldCreateUser: false }
  });

  showScreen('tfaScreen');
  document.getElementById('tfaHint').textContent =
    `A 6-digit code was sent to ${email}. Enter it below.`;
  setTimeout(() => document.querySelector('.tfa-digit').focus(), 100);
}

async function verifyTFA() {
  const token = Array.from(document.querySelectorAll('.tfa-digit')).map(d => d.value).join('');
  const err   = document.getElementById('tfaErr');
  err.style.display = 'none';

  // Demo bypass for testing — remove before going live with real clients
  if (token === '123456') {
    showView('trainer');
    await loadSubmissions();
    return;
  }

  // Verify OTP against Supabase — this creates the real authenticated session
  const { data, error } = await sb.auth.verifyOtp({
    email: pendingEmail,
    token,
    type: 'email'
  });

  if (error) {
    err.textContent = 'Incorrect or expired code. Try again or resend.';
    err.style.display = 'block';
    document.querySelectorAll('.tfa-digit').forEach(d => d.value = '');
    document.querySelector('.tfa-digit').focus();
    return;
  }

  // Authenticated — load dashboard
  showView('trainer');
  await loadSubmissions();
}

async function resendCode() {
  await sb.auth.signInWithOtp({
    email: pendingEmail,
    options: { shouldCreateUser: false }
  });
  alert('A new code has been sent to ' + pendingEmail);
}

async function logout() {
  await sb.auth.signOut();
  showView('entry');
  showScreen('choiceScreen');
  document.getElementById('loginEmail').value = '';
  document.getElementById('loginPw').value = '';
  document.querySelectorAll('.tfa-digit').forEach(d => d.value = '');
  pendingEmail = '';
}

// ── SESSION GUARD — redirect if not logged in ──
async function checkSession() {
  const { data: { session } } = await sb.auth.getSession();
  // If someone navigates directly to #trainer without logging in, send them back
  if (!session && document.getElementById('view-trainer').classList.contains('active')) {
    showView('entry');
    showScreen('choiceScreen');
  }
}

// 2FA auto-advance
document.addEventListener('DOMContentLoaded', async () => {
  document.querySelectorAll('.tfa-digit').forEach((d, i, all) => {
    d.addEventListener('input', () => {
      d.value = d.value.replace(/\D/,''); // numbers only
      if (d.value && i < all.length - 1) all[i+1].focus();
    });
    d.addEventListener('keydown', e => {
      if (e.key === 'Backspace' && !d.value && i > 0) all[i-1].focus();
    });
  });

  document.getElementById('parq-date').value = new Date().toISOString().split('T')[0];
  updateStepper();
  await checkSession();

  document.getElementById('menuBtn').addEventListener('click', () => {
    const nl = document.getElementById('navLinks');
    const open = nl.style.display === 'flex';
    nl.style.display = open ? 'none' : 'flex';
    if (!open) Object.assign(nl.style, {
      flexDirection:'column', position:'absolute', top:'100%',
      left:'0', right:'0', backgroundColor:'var(--dark-bg)',
      padding:'1rem', borderTop:'1px solid var(--border-gold)', zIndex:'999'
    });
  });
});

// ── INTAKE STEP MANAGEMENT ────────────────
let step = 0;
const TOTAL = 5;

function updateStepper() {
  for (let i = 0; i < TOTAL; i++) {
    const el = document.getElementById('step-' + i);
    el.classList.remove('active','done');
    if (i < step) el.classList.add('done');
    else if (i === step) el.classList.add('active');
  }
  document.getElementById('step-counter').textContent = `Step ${step + 1} of ${TOTAL}`;
  document.getElementById('btn-back').style.visibility = step > 0 ? 'visible' : 'hidden';
  const nb = document.getElementById('btn-next');
  if (step === TOTAL - 1) { nb.textContent = 'Submit Intake ✓'; nb.className = 'cta-submit'; }
  else { nb.textContent = 'Continue →'; nb.className = 'cta-button'; }
}

function showSection(n) {
  document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
  document.getElementById('section-' + n).classList.add('active');
}

function nextStep() {
  if (step < TOTAL - 1) { step++; showSection(step); updateStepper(); window.scrollTo(0,0); }
  else { submitIntake(); }
}
function prevStep() {
  if (step > 0) { step--; showSection(step); updateStepper(); window.scrollTo(0,0); }
}

async function submitIntake() {
  document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
  document.getElementById('form-nav').style.display = 'none';
  document.getElementById('stepper').style.display = 'none';
  document.getElementById('submit-screen').classList.add('active');
  window.scrollTo(0,0);

  // Collect all form data
  const clientName = document.getElementById('parq-name').value || 'Unknown';
  const clientAge  = document.getElementById('hh-age').value   || '';

  const payload = {
    client_name: clientName,
    client_age:  clientAge,
    parq_answers: {
      q1: ynState.q1, q2: ynState.q2, q3: ynState.q3,
      q4: ynState.q4, q4_detail: document.getElementById('q4-detail').value,
      q5: ynState.q5, q5_detail: document.getElementById('q5-detail').value,
      q6: ynState.q6, q6_detail: document.getElementById('q6-detail').value,
      q7: ynState.q7,
      signed_name: clientName,
      signed_date: document.getElementById('parq-date').value
    },
    health_history: {
      occupation:    document.getElementById('hh-occ').value,
      exercise:      document.getElementById('hh-exercise').value,
      days_per_week: document.getElementById('hh-days').value,
      alcohol:       document.getElementById('hh-alc').value,
      stress_mgmt:   document.getElementById('hh-stress').value,
      injuries:      document.getElementById('hh-inj').value,
      surgeries:     document.getElementById('hh-surg').value,
      conditions:    document.getElementById('hh-cond').value,
      medications:   document.getElementById('hh-meds').value,
      recreation:    document.getElementById('hh-rec').value
    },
    body_composition: {
      height_in:  document.getElementById('bc-ht').value,
      weight_lbs: document.getElementById('bc-wt').value,
      bmi:        document.getElementById('bc-bmi').value,
      waist:      document.getElementById('c-waist').value,
      hips:       document.getElementById('c-hips').value,
      whr:        document.getElementById('bc-whr').value,
      rhr:        document.getElementById('bc-rhr').value,
      bp:         document.getElementById('bc-bp').value,
      hrmax:      document.getElementById('bc-hrmax').value
    },
    goals: {
      primary_goal:  document.getElementById('goal-main').value,
      timeline:      document.getElementById('goal-time').value,
      availability:  document.getElementById('goal-avail').value,
      constraints:   document.getElementById('goal-constraints').value
    },
    assessment_notes: document.getElementById('notes').value,
    status: 'new'
  };

  // Save to Supabase
  const { error } = await sb.from('intake_submissions').insert([payload]);
  if (error) console.error('Supabase insert error:', error.message);

  // Update the submit screen status text
  const notifyEl = document.getElementById('notify-status');

  // Email notification to trainer via EmailJS
  const ejsServiceId  = 'service_z3s7znt';
  const ejsTemplateId = 'template_lcxggk8';

  if (!ejsServiceId.includes('YOUR')) {
    emailjs.send(ejsServiceId, ejsTemplateId, {
      client_name: clientName,
      client_age:  clientAge || 'not provided',
      message:     clientName + ' has completed their EC Fitness intake form. Log in to your trainer dashboard to review.'
    }).then(() => {
      if (notifyEl) notifyEl.textContent = '✓ Edgar has been notified by email.';
    }).catch(() => {
      if (notifyEl) notifyEl.textContent = '✓ Submission saved. Check your trainer dashboard.';
    });
  } else {
    if (notifyEl) notifyEl.textContent = '✓ Submission saved securely to your trainer dashboard.';
  }
}

// ── FORM INTERACTIONS ─────────────────────
const ynState = {};
function toggleYN(btn, key, val) {
  btn.closest('.yn-wrap').querySelectorAll('.yn-btn').forEach(b => b.classList.remove('sel'));
  btn.classList.add('sel');
  ynState[key] = val;
  const detailMap = { q4:'q4-detail', q5:'q5-detail', q6:'q6-detail' };
  if (detailMap[key]) document.getElementById(detailMap[key]).style.display = val === 'yes' ? 'block' : 'none';
}

function pickPill(btn, group) {
  btn.closest('.pill-group').querySelectorAll('.pill').forEach(p => p.classList.remove('selected'));
  btn.classList.add('selected');
}

function toggleCheck(el) {
  el.classList.toggle('on');
  el.querySelector('.check-box').textContent = el.classList.contains('on') ? '✓' : '';
}

// ── AUTO-CALCULATIONS ─────────────────────
function calcBMI() {
  const h = parseFloat(document.getElementById('bc-ht').value);
  const w = parseFloat(document.getElementById('bc-wt').value);
  document.getElementById('bc-bmi').value = (h && w) ? ((w / (h * h)) * 703).toFixed(1) : '';
}
function calcWHR() {
  const waist = parseFloat(document.getElementById('c-waist').value);
  const hips  = parseFloat(document.getElementById('c-hips').value);
  document.getElementById('bc-whr').value = (waist && hips) ? (waist / hips).toFixed(2) : '';
}
function calcHRmax() {
  const age = parseFloat(document.getElementById('hh-age').value);
  document.getElementById('bc-hrmax').value = age ? (220 - age) + ' bpm' : '';
}

// ── FILE UPLOADS ──────────────────────────
function uploaded(input, cardId, statusId) {
  if (input.files && input.files[0]) {
    document.getElementById(cardId).classList.add('has-file');
    const n = input.files[0].name;
    document.getElementById(statusId).textContent = '✓ ' + (n.length > 28 ? n.slice(0,25) + '…' : n);
  }
}

// ══════════════════════════════════════════
//  TRAINER DASHBOARD — DEMO DATA + RENDER
// ══════════════════════════════════════════
const demo = {
  name: 'Jordan M.', initials: 'JM',
  flags: [
    { level:'amber', text:'Elevated resting BP: 138/88 mmHg. Approaches threshold requiring medical clearance for vigorous resistance exercise.', src:'MacDougall et al. (1985) — arterial BP spikes during heavy resistance training; borderline hypertensive clients require physician clearance before maximal loads.' },
    { level:'amber', text:'L4-L5 disc herniation (2021) — physician-cleared but not formally PT-rehabilitated. Lumbar loading must be progressive and monitored.', src:'Lombardi & Troxel (2003) — lumbar injuries are a leading weightlifting incident category. Corrective protocol required before spinal loading.' },
    { level:'green',  text:'PAR-Q+ fully cleared — all 7 general health questions answered NO. No cardiovascular contraindications identified.', src:'Tharrett & Peterson (IHRSA) — PAR-Q+ clearance is the minimum standard for initiating a fitness program.' },
    { level:'amber', text:'Sedentary occupation: desk work 9+ hrs/day, dress shoes daily. Elevated risk for lower crossed syndrome and gastroc/soleus tightness.', src:'NASM CPT7 — prolonged sitting drives lower crossed syndrome; heel elevation chronically shortens the gastroc/soleus complex.' }
  ],
  findings: [
    { check:'Feet / Ankle', comp:'Turn Out',       over:['Lateral Gastroc','Soleus','Biceps Femoris'],        under:['Medial Gastroc','Post. Tibialis','Gluteus Max'] },
    { check:'Knee',         comp:'Valgus (Caving)',over:['Adductor Complex','TFL','Vastus Lateralis'],        under:['Glute Medius','Glute Max','VMO'] },
    { check:'LPHC',         comp:'Low Back Arch',  over:['Hip Flexors','Erector Spinae','Latissimus Dorsi'], under:['Glute Max','Hamstrings','Core Stabilizers'] },
    { check:'Upper Body',   comp:'Arms Fall Fwd',  over:['Latissimus Dorsi','Teres Major','Pec Major'],      under:['Mid Trap','Lower Trap','Rhomboids'] }
  ],
  cex: {
    inhibit:  ['Foam roll: lateral gastroc/soleus (90s each)','Foam roll: TFL/IT band (60s each side)','Foam roll: thoracic spine (90s)','Foam roll: hip flexors/psoas (60s each)'],
    lengthen: ['Static stretch: gastroc (30s × 2)','Static stretch: hip flexor lunge (30s × 2)','Pectoral doorway stretch (30s × 2)','Brettzel thoracic rotation (30s × 2)'],
    activate: ['Glute bridge isolated (2×15, 2s hold)','Clamshell (2×15 each side)','Prone cobra (2×15)','Dead bug (2×10 each side)'],
    integrate:['Goblet squat w/ heel elevation (2×12)','Cable pull-through (2×12)','Scapular wall slide (2×15)','Single-leg RDL bodyweight (2×10 each)']
  },
  stage:'Preparation', stageIdx:2,
  stageDesc:'Preparation stage — planning to begin within 2–4 weeks. High motivation, needs structure. Use Bandura proximal goal framework: set concrete 2-week "win" targets in session 1. Avoid overwhelming with complex programming upfront.',
  goals:[{label:'Lower Back Pain Relief',score:9},{label:'Weight Loss',score:8},{label:'Health Improvement',score:7},{label:'Muscle Gain',score:5}]
};

// ── DASHBOARD — load real submissions from Supabase ──
async function loadSubmissions() {
  const { data: submissions, error } = await sb
    .from('intake_submissions')
    .select('*')
    .order('created_at', { ascending: false });

  if (error) {
    console.error('Could not load submissions:', error.message);
    loadDemo(); // fall back to demo if DB not set up yet
    return;
  }

  const bar = document.getElementById('client-bar');
  // Clear existing chips except hint
  bar.innerHTML = `
    <div class="client-chip active" onclick="selectClient(this,'demo')" id="chip-demo">
      <div class="client-avatar">JM</div>
      <span class="client-name">Jordan M. · Demo</span>
      <div class="client-dot" style="background:var(--amber);"></div>
    </div>`;

  if (submissions && submissions.length > 0) {
    submissions.forEach(s => {
      const initials = (s.client_name || 'CL').split(' ').map(w => w[0]).join('').slice(0,2).toUpperCase();
      const chip = document.createElement('div');
      chip.className = 'client-chip';
      chip.id = 'chip-' + s.id;
      chip.innerHTML = `
        <div class="client-avatar">${initials}</div>
        <span class="client-name">${s.client_name || 'Client'} · ${new Date(s.created_at).toLocaleDateString()}</span>
        <div class="client-dot" style="background:${s.status==='new'?'var(--primary-gold)':'var(--green)'};"></div>`;
      chip.onclick = () => { selectClient(chip, s.id); renderRealClient(s); };
      bar.appendChild(chip);
    });
    // Auto-load the most recent real submission
    selectClient(bar.children[1], submissions[0].id);
    renderRealClient(submissions[0]);
  } else {
    bar.innerHTML += `<span class="chip-hint">← No submissions yet · Demo client shown</span>`;
    loadDemo();
  }
}

function renderRealClient(s) {
  currentClientData = s; // store for AI analysis
  const goals = s.goals || {};
  const hh    = s.health_history || {};
  const bc    = s.body_composition || {};
  const parq  = s.parq_answers || {};

  // Build flag list from PAR-Q and health history
  const flags = [];
  if (parq.q1 === 'yes') flags.push({ level:'red',   text:'PAR-Q Q1: Reported heart condition or high blood pressure.', src:'PAR-Q+ 2023 — requires medical clearance before vigorous exercise.' });
  if (parq.q2 === 'yes') flags.push({ level:'red',   text:'PAR-Q Q2: Chest pain at rest or during activity.', src:'PAR-Q+ 2023 — consult physician before any exercise program.' });
  if (parq.q4 === 'yes') flags.push({ level:'amber', text:'Chronic medical condition: ' + (parq.q4_detail || 'see intake'), src:'PAR-Q+ 2023 — review follow-up questions with client.' });
  if (parq.q5 === 'yes') flags.push({ level:'amber', text:'On prescribed medications: ' + (parq.q5_detail || 'see intake'), src:'NASM CPT7 — medications may affect heart rate response and exercise tolerance.' });
  if (parq.q6 === 'yes') flags.push({ level:'amber', text:'Bone/joint/soft tissue issue: ' + (parq.q6_detail || 'see intake'), src:'NASM CPT7 — corrective protocol required before loading affected area.' });
  if (hh.injuries)        flags.push({ level:'amber', text:'Past injuries: ' + hh.injuries, src:'Lombardi & Troxel (2003) — injury history is a leading predictor of re-injury.' });
  if (flags.length === 0) flags.push({ level:'green', text:'PAR-Q+ fully cleared — all general health questions answered NO.', src:'Tharrett & Peterson (IHRSA) — cleared for fitness program initiation.' });

  const flagsHTML = flags.map(f => `
    <div class="flag-item ${f.level}">
      <div class="flag-dot ${f.level}"></div>
      <div><div class="flag-text">${f.text}</div><div class="flag-src">${f.src}</div></div>
    </div>`).join('');

  const goalsHTML = goals.primary_goal ? `
    <div style="font-size:0.95rem; color:var(--text-light); line-height:1.75; margin-bottom:1rem;">${goals.primary_goal}</div>
    <div style="font-size:0.85rem; color:var(--text-gray);">Timeline: ${goals.timeline || 'Not specified'}</div>
    <div style="font-size:0.85rem; color:var(--text-gray);">Availability: ${goals.availability || 'Not specified'}</div>
    <div style="font-size:0.85rem; color:var(--text-gray); margin-top:0.5rem;">Constraints: ${goals.constraints || 'None noted'}</div>` :
    '<div style="color:var(--text-gray);">No goals data</div>';

  const vitalsHTML = `
    <table class="findings-table">
      <thead><tr><th>Metric</th><th>Value</th></tr></thead>
      <tbody>
        <tr><td>Height</td><td>${bc.height_in ? bc.height_in + ' in' : '—'}</td></tr>
        <tr><td>Weight</td><td>${bc.weight_lbs ? bc.weight_lbs + ' lbs' : '—'}</td></tr>
        <tr><td>BMI</td><td>${bc.bmi || '—'}</td></tr>
        <tr><td>Waist-to-Hip Ratio</td><td>${bc.whr || '—'}</td></tr>
        <tr><td>Resting Heart Rate</td><td>${bc.rhr ? bc.rhr + ' bpm' : '—'}</td></tr>
        <tr><td>Blood Pressure</td><td>${bc.bp || '—'}</td></tr>
        <tr><td>HRmax Estimate</td><td>${bc.hrmax || '—'}</td></tr>
      </tbody>
    </table>`;

  document.getElementById('dash-grid').innerHTML = `
    <div class="dash-card wide">
      <div class="card-label">Safety &amp; Risk Assessment
        <span class="badge ${flags.some(f=>f.level==='red')?'badge-red':flags.some(f=>f.level==='amber')?'badge-amber':'badge-green'}">
          ${flags.filter(f=>f.level!=='green').length} FLAG${flags.filter(f=>f.level!=='green').length!==1?'S':''}
        </span>
      </div>
      <div class="flag-list">${flagsHTML}</div>
    </div>
    <div class="dash-card">
      <div class="card-label">Body Composition &amp; Vitals</div>
      ${vitalsHTML}
    </div>
    <div class="dash-card full">
      <div class="card-label">Client Goals &amp; Availability</div>
      ${goalsHTML}
    </div>
    <div class="dash-card full">
      <div class="card-label">Medical &amp; Lifestyle Notes</div>
      <table class="findings-table">
        <thead><tr><th>Category</th><th>Client Response</th></tr></thead>
        <tbody>
          <tr><td>Occupation</td><td>${hh.occupation || '—'}</td></tr>
          <tr><td>Current Exercise</td><td>${hh.exercise || '—'}</td></tr>
          <tr><td>Past Injuries</td><td>${hh.injuries || 'None reported'}</td></tr>
          <tr><td>Past Surgeries</td><td>${hh.surgeries || 'None reported'}</td></tr>
          <tr><td>Health Conditions</td><td>${hh.conditions || 'None reported'}</td></tr>
          <tr><td>Medications</td><td>${hh.medications || 'None reported'}</td></tr>
          <tr><td>Assessment Notes</td><td>${s.assessment_notes || 'None'}</td></tr>
        </tbody>
      </table>
    </div>`;

  // Mark as reviewed in Supabase
  sb.from('intake_submissions').update({ status: 'reviewed' }).eq('id', s.id).then(() => {});
}

function selectClient(chip, id) {
  document.querySelectorAll('.client-chip').forEach(c => c.classList.remove('active'));
  chip.classList.add('active');
  if (id === 'demo') { currentClientData = null; renderDash(demo); }
  // real clients are handled by their chip.onclick in loadSubmissions()
}

function renderDash(c) {
  const flagsHTML = c.flags.map(f => `
    <div class="flag-item ${f.level}">
      <div class="flag-dot ${f.level}"></div>
      <div><div class="flag-text">${f.text}</div><div class="flag-src">${f.src}</div></div>
    </div>`).join('');

  const findingsHTML = c.findings.map(f => `
    <tr>
      <td>${f.check}</td>
      <td><span class="comp-tag">${f.comp}</span></td>
      <td><div class="mtags">${f.over.map(m=>`<span class="mtag over">${m}</span>`).join('')}</div></td>
      <td><div class="mtags">${f.under.map(m=>`<span class="mtag under">${m}</span>`).join('')}</div></td>
    </tr>`).join('');

  const stages = ['Pre-contemplation','Contemplation','Preparation','Action','Maintenance'];
  const segs   = stages.map((_,i) => `<div class="stage-seg${i<=c.stageIdx?' lit':''}"></div>`).join('');
  const sLbls  = stages.map(n => `<div class="stage-lbl">${n.slice(0,5)}.</div>`).join('');
  const goalsHTML = c.goals.map(g => `
    <div class="goal-item">
      <span style="min-width:180px;">${g.label}</span>
      <div class="goal-bar-bg"><div class="goal-bar" style="width:${g.score*10}%"></div></div>
      <span class="goal-score">${g.score}/10</span>
    </div>`).join('');

  document.getElementById('dash-grid').innerHTML = `
    <div class="dash-card wide">
      <div class="card-label">Safety &amp; Risk Assessment <span class="badge badge-amber">2 FLAGS</span></div>
      <div class="flag-list">${flagsHTML}</div>
    </div>
    <div class="dash-card">
      <div class="card-label">Behavior Stage &amp; Goal Alignment</div>
      <div class="stage-track">${segs}</div>
      <div class="stage-lbls">${sLbls}</div>
      <div class="stage-current">${c.stage}</div>
      <div class="stage-desc">${c.stageDesc}</div>
      <div class="goal-list">${goalsHTML}</div>
    </div>
    <div class="dash-card full">
      <div class="card-label">Biomechanical Findings <span class="badge badge-red">4 COMPENSATIONS</span></div>
      <table class="findings-table">
        <thead><tr><th>Checkpoint</th><th>Compensation</th><th>Overactive → Inhibit / Lengthen</th><th>Underactive → Activate / Integrate</th></tr></thead>
        <tbody>${findingsHTML}</tbody>
      </table>
      <p style="margin-top:1rem; font-size:0.76rem; color:var(--text-gray); font-style:italic;">Source: NASM CPT7 Solutions Table · AI_Fitness_Assessment_and_Programming.xlsx</p>
    </div>
    <div class="dash-card wide">
      <div class="card-label">Corrective Exercise Protocol — CEX Continuum</div>
      <div class="cex-stages">
        <div class="cex-stage"><div class="cex-stage-num">Stage 1</div><div class="cex-stage-name">Inhibit</div>${c.cex.inhibit.map(i=>`<div class="cex-item">${i}</div>`).join('')}</div>
        <div class="cex-stage"><div class="cex-stage-num">Stage 2</div><div class="cex-stage-name">Lengthen</div>${c.cex.lengthen.map(i=>`<div class="cex-item">${i}</div>`).join('')}</div>
        <div class="cex-stage"><div class="cex-stage-num">Stage 3</div><div class="cex-stage-name">Activate</div>${c.cex.activate.map(i=>`<div class="cex-item">${i}</div>`).join('')}</div>
        <div class="cex-stage"><div class="cex-stage-num">Stage 4</div><div class="cex-stage-name">Integrate</div>${c.cex.integrate.map(i=>`<div class="cex-item">${i}</div>`).join('')}</div>
      </div>
    </div>
    <div class="dash-card">
      <div class="card-label">Session 1 Prep Notes</div>
      <div class="flag-list">
        <div class="flag-item amber"><div class="flag-dot amber"></div><div><div class="flag-text">Confirm BP at session start. If ≥140/90, defer loading protocol.</div><div class="flag-src">MacDougall et al. (1985)</div></div></div>
        <div class="flag-item amber"><div class="flag-dot amber"></div><div><div class="flag-text">Do NOT begin spinal loading until L4-L5 history is reviewed verbally and OHSA is pain-free.</div><div class="flag-src">Lombardi &amp; Troxel (2003)</div></div></div>
        <div class="flag-item green"><div class="flag-dot green"></div><div><div class="flag-text">Set 2-week proximal goal targets in session 1 — build early confidence and momentum.</div><div class="flag-src">Bandura &amp; Simon (1977)</div></div></div>
        <div class="flag-item green"><div class="flag-dot green"></div><div><div class="flag-text">Preparation-stage client — high motivation, needs one clear action plan. Avoid info overload.</div><div class="flag-src">Krause (NASM, 2008)</div></div></div>
      </div>
    </div>`;
}

// ── AI ANALYSIS ───────────────────────────
// ── CURRENT CLIENT STATE ─────────────────
let currentClientData = null; // set when a real client is selected

async function generateAI() {
  const btn  = document.getElementById('ai-btn');
  const spin = document.getElementById('spinner');
  const resp = document.getElementById('ai-response');
  const text = document.getElementById('ai-text');

  spin.style.display = 'block';
  btn.disabled = true;
  resp.classList.add('visible');
  text.textContent = 'Generating full client analysis';
  text.classList.add('loading-dots');

  // Build prompt from real client data if available, otherwise use demo
  const prompt = currentClientData ? buildRealPrompt(currentClientData) : buildDemoPrompt();

  const apiKey = document.getElementById('runtime-api-key').value.trim();
  if (!apiKey) {
    text.classList.remove('loading-dots');
    text.textContent = '[Please paste your Anthropic API key in the field above first.]';
    spin.style.display = 'none';
    btn.disabled = false;
    return;
  }

  try {
    const res = await fetch("https://corsproxy.io/?https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": apiKey,
        "anthropic-version": "2023-06-01"
      },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 2000,
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    if (data.error) {
      text.classList.remove('loading-dots');
      text.textContent = '[API Error: ' + data.error.message + ']';
      spin.style.display = 'none';
      btn.disabled = false;
      return;
    }
    const out = data.content.map(i => i.text || '').join('\n');
    text.classList.remove('loading-dots');
    text.textContent = out;
  } catch(e) {
    text.classList.remove('loading-dots');
    text.textContent = '[Error: ' + e.message + ']';
  }

  spin.style.display = 'none';
  btn.disabled = false;
}

function buildRealPrompt(s) {
  const hh   = s.health_history    || {};
  const bc   = s.body_composition  || {};
  const goals = s.goals            || {};
  const parq = s.parq_answers      || {};

  // Build risk flags from PAR-Q
  const riskItems = [];
  if (parq.q1 === 'yes') riskItems.push('Heart condition or high blood pressure (PAR-Q Q1)');
  if (parq.q2 === 'yes') riskItems.push('Chest pain at rest or during activity (PAR-Q Q2)');
  if (parq.q4 === 'yes') riskItems.push('Chronic medical condition: ' + (parq.q4_detail || 'see intake'));
  if (parq.q5 === 'yes') riskItems.push('Prescribed medications: ' + (parq.q5_detail || 'see intake'));
  if (parq.q6 === 'yes') riskItems.push('Bone/joint/soft tissue issue: ' + (parq.q6_detail || 'see intake'));
  if (hh.injuries && hh.injuries.toLowerCase() !== 'none') riskItems.push('Past injuries: ' + hh.injuries);
  if (hh.surgeries && hh.surgeries.toLowerCase() !== 'none') riskItems.push('Past surgeries: ' + hh.surgeries);

  return `You are the EC Fitness AI Specialist — a highly advanced biomechanical analyst and NASM-certified personal training program designer.

CLIENT PROFILE:
- Name: ${s.client_name || 'Client'}, Age: ${s.client_age || 'Unknown'}
- Occupation: ${hh.occupation || 'Not specified'}
- Exercise history: ${hh.exercise || 'Not provided'} (${hh.days_per_week || '?'} days/week)
- Height: ${bc.height_in || '?'} in | Weight: ${bc.weight_lbs || '?'} lbs | BMI: ${bc.bmi || '?'}
- Waist-to-Hip Ratio: ${bc.whr || '?'} | Resting HR: ${bc.rhr || '?'} bpm | BP: ${bc.bp || 'not provided'}
- HRmax estimate: ${bc.hrmax || '?'}

RISK FLAGS:
${riskItems.length > 0 ? riskItems.map(r => '- ' + r).join('\n') : '- PAR-Q+ fully cleared, no flags identified'}

HEALTH CONDITIONS: ${hh.conditions || 'None reported'}
MEDICATIONS: ${hh.medications || 'None reported'}

CLIENT GOALS (in their own words): "${goals.primary_goal || 'Not provided'}"
Timeline: ${goals.timeline || 'Not specified'}
Availability: ${goals.availability || 'Not specified'}
Constraints: ${goals.constraints || 'None noted'}

POSTURAL SELF-REPORT & ASSESSMENT NOTES:
${s.assessment_notes || 'No additional notes provided'}

LIFESTYLE:
- Stress level: ${hh.stress_mgmt || 'not noted'}
- Recreation: ${hh.recreation || 'none noted'}

---

Generate a complete EC Fitness Pre-Session Clinical Briefing with ALL five sections below. Be specific to THIS client's data. Cite every clinical claim. No generic filler.

═══════════════════════════════════════
SECTION 1 — RISK ASSESSMENT & MEDICAL FLAGS
═══════════════════════════════════════
List each flag with: the specific risk, why it matters for training, and the clinical action required before proceeding. Cite research. If no flags, confirm clearance.

═══════════════════════════════════════
SECTION 2 — BIOMECHANICAL OBSERVATIONS
═══════════════════════════════════════
Based on their postural self-report, occupation, and lifestyle, identify the most likely movement dysfunctions using the NASM Corrective Exercise Continuum framework. Name the probable overactive and underactive muscle groups. Explain the functional implications for their training.

═══════════════════════════════════════
SECTION 3 — CORRECTIVE EXERCISE PROTOCOL (CEX)
═══════════════════════════════════════
Build a corrective warmup sequence using all 4 CEX stages:
INHIBIT: (foam rolling — name muscles, duration)
LENGTHEN: (static stretching — name muscles, duration, sets)
ACTIVATE: (isolated strengthening — name exercises, sets, reps, tempo)
INTEGRATE: (integrated dynamic movements — name exercises, sets, reps)
Justify each choice based on this client's specific dysfunction profile.

═══════════════════════════════════════
SECTION 4 — BEHAVIOR STAGE STRATEGY
═══════════════════════════════════════
Identify their transtheoretical behavior stage based on their goals and history. Prescribe the optimal coaching approach using Bandura & Simon (1977) proximal goal-setting and Krause (NASM 2008) stage-matched intervention strategies.

═══════════════════════════════════════
SECTION 5 — WEEK 1 TRAINING PROGRAM
═══════════════════════════════════════
Design a complete Week 1 program based on their availability, goals, fitness level, and dysfunction profile. For each training day include:
- Day focus (e.g., Lower Body Corrective Strength)
- Corrective warmup (from Section 3)
- Main training block: exercise name, sets × reps, tempo, rest period
- Cool-down

Choose NASM OPT Phase 1 (Stabilization Endurance) or Phase 2 (Strength Endurance) based on their profile. Justify the phase selection. Use realistic, achievable loads and volumes for their fitness level.`;
}

function buildDemoPrompt() {
  return `You are the EC Fitness AI Specialist — a highly advanced biomechanical analyst and NASM-certified personal training program designer.

CLIENT PROFILE (Demo: Jordan M., Age 34, sedentary desk worker 9+ hrs/day, dress shoes daily):
- Height: 5'10" | Weight: 192 lbs | BMI: 27.6 | WHR: 0.91 | RHR: 74 bpm | BP: 138/88 mmHg
- HRmax estimate: 186 bpm

RISK FLAGS:
- Borderline elevated BP: 138/88 mmHg (approaches Stage 1 hypertension threshold)
- L4-L5 disc herniation (2021) — physician-cleared, not formally PT-rehabilitated
- Prolonged sitting 9+ hrs/day with daily heel elevation (dress shoes)

CLIENT GOALS: "I want to lose 20 lbs before my MBA graduation in May and fix the lower back pain that gets worse every time I sit through long meetings."
Timeline: 16 weeks | Availability: 4 days/week, evenings after 7pm
Constraints: Apartment gym only, right knee mildly irritated on stairs

OHSA COMPENSATIONS:
1. Feet turn out — Overactive: Lateral Gastroc, Soleus, Biceps Femoris | Underactive: Medial Gastroc, Post. Tibialis, Glute Max
2. Knee valgus — Overactive: Adductor Complex, TFL | Underactive: Glute Med, Glute Max, VMO
3. Low back arches — Overactive: Hip Flexors, Erector Spinae, Lat Dorsi | Underactive: Glute Max, Hamstrings, Core Stabilizers
4. Arms fall forward — Overactive: Lats, Teres Major, Pec Major | Underactive: Mid/Lower Trap, Rhomboids

BEHAVIOR STAGE: Preparation (planning to start, high motivation, needs structure)

---

Generate a complete EC Fitness Pre-Session Clinical Briefing with ALL five sections. Cite every clinical claim. Be specific and actionable.

═══════════════════════════════════════
SECTION 1 — RISK ASSESSMENT & MEDICAL FLAGS
═══════════════════════════════════════

═══════════════════════════════════════
SECTION 2 — BIOMECHANICAL OBSERVATIONS
═══════════════════════════════════════

═══════════════════════════════════════
SECTION 3 — CORRECTIVE EXERCISE PROTOCOL (CEX)
═══════════════════════════════════════
INHIBIT → LENGTHEN → ACTIVATE → INTEGRATE

═══════════════════════════════════════
SECTION 4 — BEHAVIOR STAGE STRATEGY
═══════════════════════════════════════

═══════════════════════════════════════
SECTION 5 — WEEK 1 TRAINING PROGRAM
═══════════════════════════════════════
4 days, apartment gym, NASM OPT Phase selection with justification. Full exercise prescription: sets × reps, tempo, rest.`;
}
</script>
</body>
</html>
